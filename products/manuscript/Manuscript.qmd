---
title: "An Analysis of Rural-Urban Difference in Drinking Water System Violations in Georgia"
author: "Talia C. Swanson, B.S."
format:
  docx:
    toc: false
    number-sections: true
    highlight-style: github
bibliography: ../../assets/dataanalysis-references.bib
csl: ../../assets/american-journal-of-epidemiology.csl
---

## Description of data and data source
The primary data source for this project is the Safe Drinking Water Infromation System (SDWIS) maintianed by the Environmental Protection Agency (EPA). SDWIS is a national databased maintained by the EPA to monitor compliance with the Safe Drinking Water Act. The data are collected through reports submitted by public water systems and state primacy agencies, including detailed information on water system characteristics and drinking water violations.

Two primary SDWIS datasets will be used with the first containg water system-level information inclduing system identification, numbers, system type, population served, geographic location, and ownership characteristics. The second dataset includes violation level records, documenting containment, violation type and dates.

## Questions/Hypotheses to be addressed
The primary research question for this project is:

Are rural public water systems in Georgia more likely to experience drinking water quality violations compared to urban water systems?

The outcome of interest is the occurence of drinking water quality violations (either as a binary indicator or collective count of violations per system). The primary predictor of interest is rural versus urban area classification of the water system's service area. The analysis will explore patterns in violation frequency and distribution across rural and urban systems and assess whether disparities persist after accounting for system and community characteristics. 



{{< pagebreak >}}


# Methods/Planned Analysis Approach 

The analysis will begin with data cleaning and processing, including filtering for Georgia water systems, merging system and violation datasets, and handling missing values. Exploratory data analysis will be used to examine distributions, identify patterns, and visualize difference in violations between rural and urban systems. 

Descriptive summaries will be used to examine the distribution of water system characteristics such as population served and rural urban classfication. Visualization will be used to compare drinking water violations between rural and urban systems, such technique will include bar plots showing the proportions of systems with violations and histograms of violation counts and population service. 


# Sample Exploratory Data Analysis 
This will load the SDWA public water systems datatset and the RUCA ZIP code classification datatser into R. These datasets contian infromation on public water system characterstics and rural-urban classifications. 
```{r}

library(tidyverse)
library(here)

# Load datasets
systems <- read_csv(here("data", "raw-data", "SDWA_PUB_WATER_SYSTEMS.csv"))
ruca <- read_csv(here("data", "raw-data", "RUCA-codes-2020-zipcode.csv"))

glimpse(systems)
glimpse(ruca)

```


This will filter the public water system dataset to include only systems located in GA using the STATE_CODE variable. After filtering, there are 5256 remaining observations, confirming that the restriction was applied and to gain the final sample size for analysis. 
```{r}
systems_ga <- systems |>
  filter(STATE_CODE == "GA")

# Check sample size
nrow(systems_ga)
```

```{r}
systems_ga_filtered <- systems_ga
```

Looking at the types of public water systems in Georgia, community water systems were the most common (n=2722), followed by transient non-community systems n= 2,004 and non-transiet non-community systems (n=530)
  * CWS (community water system)
  * TNCWS (transient non-community water system)
  * NTNCWS (non-transient non-community water system)

```{r}
ggplot(systems_ga, aes(x= PWS_TYPE_CODE))+
  geom_bar (fill="steelblue")+
  labs(
    title = "Count of Public Water Sytem Types in Georgia",
    x = "Water System Type",
    y = "Number of Systems"
  )
```


```{r}
systems_ga |>
  count(PWS_TYPE_CODE, sort = TRUE)
  
```

This allows for summary statistics to be calculate, in this context, this shows the distirbution and range of populations served by public water systems in Georgia

```{r}
summary (systems_ga$POPULATION_SERVED_COUNT)
  
```


This puts into persepctive of how many people that the water systems serve. Approximately 25% of the systems served fewer than 49 people, while 75% of the systems served fewer than 262 people. 

```{r}
systems_ga_filtered <- systems_ga |>
  filter(POPULATION_SERVED_COUNT>0)
ggplot(
  data=systems_ga_filtered,
  mapping = aes(x=POPULATION_SERVED_COUNT)
) +
  geom_histogram(bins=40)+
  scale_x_log10(
    breaks = c(10,100,1000,10000,100000),
    labels = c("10", "100", "1,000", "10,000", "100,000")
  ) +
  labs(
    title = "Distribution of Population Served by Public Water Systems in Georgia",
    x= "Population Served",
    y= "Number of Systems"
  )
  
```

In this step, I filtered the to include public water systems in Georgia that serve a population > 0. After this, a histogram was created to visualize the distribution of population sized serve by the public systems. 

The histogram appear to be a strongly skewed right distribution, showing a large varation in system size. Most water systems serve a smaller population of individuals with the median population served being 100 people. However, the long right tail is a result of some water systems serving a large population of individuals reaching up to 1 million indivduals. 


```{r}
violations <- read_csv(here("data", "raw-data", "SDWA_PN_VIOLATION_ASSOC.csv"))
```

```{r}
library(dplyr)

# Filter water systems in Georgia
systems_ga <- systems %>%
  filter(STATE_CODE == "GA")

# Keep violations for those Georgia water systems
violations_ga <- violations %>%
  inner_join(systems_ga %>% select(PWSID), by = "PWSID")

# Count violations per system in Georgia
violation_summary <- violations_ga %>%
  group_by(PWSID) %>%
  summarise(violation_count = n()) %>%
  count(violation_count) %>%
  rename(Number_of_Systems = n, Violation_Count = violation_count)

print(violation_summary)
```

```{r}
ggplot(violation_summary, aes(x = factor(Violation_Count), y = Number_of_Systems)) +
  geom_bar(stat = "identity", fill = "darkred") +
  labs(
    title = "Distribution of Drinking Water Violations per Public Water System in Georgia",
    x = "Number of Violations",
    y = "Number of Water Systems"
  ) +
  theme_minimal()
```







